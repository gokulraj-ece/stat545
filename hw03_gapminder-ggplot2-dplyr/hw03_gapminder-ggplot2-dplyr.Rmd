---
title: "Gapminder, ggplot2 and dplyr single table verbs"
author: "Gokul Raj Suresh Kumar"
date: "`r format(Sys.Date())`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Manipulate and Explore Gapminder with dplyr & ggplot2

##Bringing rectangular data in

####Loading the tidyverse and gapminder packages 

```{r message=FALSE}
library(tidyverse)
library(gapminder)
```

##Tasks

####Maximum and Minimum of `gdpPercap` for all continents

```{r results = 'asis'}
my_gap <- gapminder

gdp_data <- my_gap %>% 
  group_by( continent ) %>% 
  summarize( min_gdp_percap = min( gdpPercap ) , max_gdp_percap = max( gdpPercap ))

knitr::kable( gdp_data )
```

```{r}
gdp_data %>%
  ggplot( aes( x = continent , y = min_gdp_percap )) + 
  geom_point(size = 4)

gdp_data %>%
  ggplot( aes( x = continent , y = max_gdp_percap )) + 
  geom_point(size = 4)
```

####Spread of `gdpPercap` within the continents

```{r results = 'asis'}
spread_data <- my_gap %>%
  group_by(continent) %>% 
  summarize( spread_by_continent = ( max( gdpPercap ) - min( gdpPercap )))

knitr::kable( spread_data )
```

```{r}
spread_data %>%
  ggplot( aes( x = continent , y = spread_by_continent )) + 
  geom_point( size = 4 )
```


#### Life expectancy over time for different continents

```{r}
expectancy_data <- my_gap %>%
  select(continent , lifeExp , year) %>%
  filter(year %in% c(1957 , 1967 , 1977 , 1987 , 1997 , 2007)) %>% 
  group_by(continent , year) %>% 
  summarise(avg_life_exp = mean(lifeExp)) %>% 
  print(n = 10)
```

```{r}
expectancy_data %>%
  ggplot( aes( x = year , y = avg_life_exp )) + 
  geom_point( aes( color = continent )) + 
  geom_line( aes( group = continent , color =   continent ))
```

####Relative abundance of country with low life expectancy over time by continent

```{r}
benchmark <- my_gap %>% 
  filter( country == "India" )

relative_life_expectancy <- my_gap %>% 
  mutate( temp = rep( benchmark$lifeExp , nlevels( country )), 
         lifeExpRel = lifeExp/temp, 
         temp = NULL)

relative_abundance <- relative_life_expectancy %>%
  group_by( continent , year)%>% 
  filter( lifeExpRel < 1 )%>% 
  summarise( n_countries = n_distinct( country )) %>% 
  print( n = 10 )
```

```{r}
relative_life_expectancy %>%
  ggplot( aes( x = year , y = lifeExpRel )) + 
  geom_point() + facet_wrap( ~continent ) + geom_line( aes( group = country ))
```



