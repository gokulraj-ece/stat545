---
title: "Tidy data and joins"
author: "Gokul Raj Suresh Kumar"
date: "`r format(Sys.Date())`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Tidying data and performing joins

####Loading the tidyverse and gapminder packages

```{r message=FALSE}
library( tidyverse )
library( gapminder )
```

##General data reshaping and relationship to aggregation

###Activity #2 

####Life expectancy for different countries by year

```{r}
different_countries <- gapminder %>% 
  select( year , country , lifeExp ) %>% 
  filter( country %in% c( "India" , "Canada" , "United States" , "China" , "Japan" ) )

le_by_year <- different_countries %>% 
  spread ( key = "country" , value = "lifeExp" ) %>% 
  rename( Year = year )

knitr::kable( le_by_year )

le_by_year %>% ggplot( ) +
  geom_point( aes( x = Year , y = India ) ) +  
  geom_smooth( aes( x = Year , y = India ) , color = "Purple" , se = FALSE ) +
  geom_point( aes( x = Year , y = Canada ) ) +  
  geom_smooth( aes( x = Year , y = Canada ) , color = "Green" , se = FALSE ) +
  labs( title = "Life Expectancy over Time" , x = "Year" , y = "lifeExp" )
```

##Activity #3

####Mean life expectancy for all years by continent

```{r}
all_continents <- gapminder %>% 
  select( continent , year , lifeExp ) %>% 
  group_by( year , continent ) %>% 
  summarise( mean_lifeExp = mean( lifeExp ) ) %>% 
  arrange( continent )

le_continents <- all_continents %>% 
  spread( key = "continent" , value = "mean_lifeExp") %>% 
  rename( Year = year )

knitr::kable( le_continents )

le_continents %>% ggplot( ) +
  geom_point( aes( x = Year , y = Africa ) ) +
  geom_smooth( aes( x = Year , y = Africa ) , color = "red" , se = FALSE ) +
  geom_point( aes( x = Year , y = Americas ) ) +
  geom_smooth( aes( x = Year , y = Americas ) , color = "orange" , se = FALSE ) +
  geom_point( aes( x = Year , y = Asia ) ) +
  geom_smooth( aes( x = Year , y = Asia ) , color = "green" , se = FALSE ) +
  geom_point( aes( x = Year , y = Europe ) ) +
  geom_smooth( aes( x = Year , y = Europe ) , color = "brown" , se = FALSE ) +
  geom_point( aes( x = Year , y = Oceania ) ) + 
  geom_smooth( aes( x = Year , y = Oceania ) , color = "Purple" , se = FALSE ) +
  labs( title = "Life Expectancy over Time" , x = "Year" , y = "Life Expectancy" )
```

##Activity #4

#### Continents having lowest and highest life expectancy by year

```{r}
min_max_le <- gapminder %>%
  select( year , continent , lifeExp ) %>%
  group_by( year ) %>%
  filter( min_rank( desc( lifeExp) ) == 1 | min_rank( lifeExp ) == 1 ) %>% 
  arrange( year )

min_max_le_continent <- min_max_le %>% 
  spread( key = "continent" , value = "lifeExp" ) %>% 
  rename( Year = year )

knitr::kable( min_max_le_continent )
```

##General data reshaping and relationship to aggregation
